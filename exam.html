<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Demo Exam</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bar:#2f4f60;
      --bar2:#5f93c2;
      --ink:#1f2937;
      --muted:#6b7280;
      --bg:#f3f4f6;
      --card:#ffffff;
      --line:#d6dde6;
      --btn:#2f6ea5;
      --btn2:#245a87;
      --warn:#b45309;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--ink)}
    .app{min-height:100vh;display:flex;flex-direction:column}

    .topbar{
      height:44px;
      background:var(--bar);
      color:#fff;
      display:flex;
      align-items:center;
      padding:0 18px;
      font-size:14px;
      line-height:1.2;
      gap:12px;
      justify-content:space-between;
    }
    .topbar .left{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .topbar .right{
      display:flex;align-items:center;gap:18px;font-size:14px;white-space:nowrap;
    }
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:2px 8px;border-radius:999px;
      background:rgba(255,255,255,.12);
    }
    .icon{width:16px;height:16px;display:inline-block;vertical-align:-2px}

    .subbar{
      background:var(--bar2);
      color:#fff;
      padding:8px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:14px;
    }
    .subbar a{
      color:#fff;text-decoration:underline;cursor:pointer;
      display:inline-flex;align-items:center;gap:8px;
    }
    .flag{
      display:inline-flex;align-items:center;gap:8px;
      cursor:pointer;
      user-select:none;
      font-weight:600;
    }
    .flag svg{width:16px;height:16px;display:inline-block}
    .flag .flagFill{fill:transparent}
    .flag .flagStroke{stroke:white}
    .flag.on .flagFill{fill:#d8342a}
    .flag.on .flagStroke{stroke:#d8342a}

    .main{
      flex:1;
      padding:18px 14px 0;
      background:#fff;
      border-top:1px solid rgba(255,255,255,.2);
    }
    .wrap{
      max-width:1100px;margin:0 auto;
      padding:10px 6px 70px;
    }
    .hint{color:var(--muted);font-size:14px;margin:6px 0 16px}
    .qtitle{font-size:15px;margin:10px 0 16px}
    .question{font-size:16px;margin:0 0 14px}
    .answers{display:flex;flex-direction:column;gap:10px}
    .ans{
      display:flex;align-items:flex-start;gap:10px;
      padding:6px 0;
      border-bottom:1px dotted #e5e7eb;
      max-width:520px;
    }
    .ans:last-child{border-bottom:none}
    .ans input{margin-top:3px}
    .ans .label{
      width:18px;font-weight:bold;color:var(--muted)
    }

    .footer{
      position:fixed;left:0;right:0;bottom:0;
      background:var(--bar);
      padding:10px 14px;
      display:flex;justify-content:space-between;align-items:center;
      border-top:1px solid rgba(255,255,255,.18);
      gap:12px;
    }
    .footerLeft{min-width:160px}
    .footerRight{display:flex;align-items:center;gap:10px;margin-left:auto}
    .navbtn{
      background:transparent;
      color:#fff;
      border:1px solid rgba(255,255,255,.55);
      padding:10px 14px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
      display:flex;align-items:center;gap:10px;
      white-space:nowrap;
    }
    .navbtn:hover{background:rgba(255,255,255,.10)}
    .navbtn--review{
      border-color:rgba(255,255,255,.35);
      background:rgba(255,255,255,.08);
      font-weight:600;
      letter-spacing:.01em;
    }
    .navbtn--next{
      background:rgba(255,255,255,.12);
      border-color:rgba(255,255,255,.7);
    }
    .navDivider{
      width:1px;height:28px;
      background:rgba(255,255,255,.25);
      margin:0 2px;
    }
    .arrow{
      width:10px;height:10px;border-top:2px solid #fff;border-right:2px solid #fff;
      transform:rotate(45deg);
    }
    .arrow.left{transform:rotate(-135deg)}
    .arrow.right{transform:rotate(45deg)}

    .modalBack{
      position:fixed;inset:0;background:rgba(0,0,0,.45);
      display:none;align-items:center;justify-content:center;
      padding:16px;
    }
    .modal{
      width:min(520px, 96vw);
      background:var(--card);
      border-radius:10px;
      box-shadow:0 16px 50px rgba(0,0,0,.25);
      overflow:hidden;
      border:1px solid rgba(0,0,0,.08);
    }
    .modalHead{
      background:var(--bar);
      color:#fff;
      padding:12px 14px;
      display:flex;justify-content:space-between;align-items:center;
      font-weight:bold;
    }
    .modalBody{padding:14px}
    .close{
      background:rgba(255,255,255,.15);
      border:1px solid rgba(255,255,255,.25);
      color:#fff;cursor:pointer;padding:6px 10px;border-radius:8px;
    }
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;color:var(--muted);font-size:12px}
    .calcGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    .calcGrid input{width:100%;padding:10px;border:1px solid var(--line);border-radius:8px}

    @media (max-width:520px){
      .topbar{font-size:16px}
      .topbar .right{font-size:14px;gap:10px}
      .answers{max-width:100%}
      .ans{max-width:100%}
    }

    .calcOverlay{
      position:fixed;inset:0;background:rgba(0,0,0,.35);
      display:none;align-items:center;justify-content:center;
      z-index:9999;padding:24px;
    }
    .calcOverlay.open{display:flex}
    .calcWin{
      width:320px;max-width:92vw;
      border-radius:10px;
      box-shadow:0 18px 45px rgba(0,0,0,.35);
      background:#3f6ea3;
      border:1px solid rgba(255,255,255,.35);
      overflow:hidden;
    }
    .calcTitle{
      height:46px;display:flex;align-items:center;justify-content:space-between;
      padding:0 12px;color:#fff;font-weight:700;letter-spacing:.2px;
      background:rgba(0,0,0,.06);
      border-bottom:1px solid rgba(255,255,255,.25);
    }
    .calcTitle .left{display:flex;align-items:center;gap:8px}
    .calcTitle .miniIcon{width:16px;height:16px;display:inline-block}
    .calcTitle button{
      background:transparent;border:0;color:#fff;width:32px;height:32px;border-radius:8px;
      cursor:pointer;display:grid;place-items:center;
    }
    .calcTitle button:hover{background:rgba(255,255,255,.12)}
    .calcBody{padding:14px 14px 16px}
    .calcMeta{display:flex;align-items:center;gap:8px;color:#eaf2ff;font-weight:600;margin-bottom:10px}
    .calcMeta select{border:0;border-radius:8px;padding:6px 10px;font-weight:700;outline:none}
    .calcDisplay{
      background:#e9edf3;border-radius:6px;padding:12px 10px;
      font-size:34px;font-weight:800;text-align:right;color:#111;
      box-shadow:inset 0 0 0 2px rgba(0,0,0,.12);
      font-variant-numeric:tabular-nums;line-height:1;
      overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
    }
    .calcBrand{display:flex;align-items:center;justify-content:space-between;margin:10px 2px 12px;color:#dfeaff;font-weight:800;letter-spacing:.2px;opacity:.95;user-select:none}
    .calcBrand small{font-weight:800;opacity:.95}
    .calcKeys{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .calcBtn{
      height:44px;border-radius:8px;border:0;cursor:pointer;
      font-weight:900;font-size:16px;
      box-shadow:0 4px 0 rgba(0,0,0,.18);
      transition:transform .04s ease;user-select:none;
    }
    .calcBtn:active{transform:translateY(1px)}
    .calcBtn.red{background:#c63a3a;color:#fff}
    .calcBtn.gray{background:#f2f4f7;color:#111}
    .calcBtn.tall{grid-row:span 2;height:98px}
    .calcBtn.wide{grid-column:span 2}

    .reviewOverlay{
      position:fixed;inset:0;background:#fff;
      display:none;z-index:9998;
    }
    .reviewOverlay.open{display:block}
    .reviewTop{
      height:44px;background:var(--bar);color:#fff;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 18px;font-size:14px;font-weight:600;
    }
    .reviewTop .rtLeft{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .reviewTop .rtRight{display:flex;align-items:center;gap:16px}
    .reviewTop .rtBtn{
      background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);
      color:#fff;border-radius:8px;padding:6px 10px;cursor:pointer;font-weight:700;
    }
    .reviewSub{
      height:34px;background:#97b4dc;color:#fff;
      display:flex;align-items:center;gap:10px;
      padding:0 18px;font-weight:700;
      border-bottom:1px solid rgba(0,0,0,.08);
    }
    .reviewSub a{color:#fff;text-decoration:underline;cursor:pointer}
    .reviewCenterTitle{
      text-align:center;font-size:20px;font-family:Georgia,serif;
      padding:8px 0 5px;color:#111;
    }
    .reviewSectionBar{
      height:26px;background:#97b4dc;color:#fff;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 18px;font-weight:800;
      border-top:1px solid rgba(0,0,0,.08);
      border-bottom:1px solid rgba(0,0,0,.08);
    }
    .reviewSectionBar .left{display:flex;align-items:center;gap:10px}
    .reviewSectionBar .right{opacity:.95}
    .reviewList{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:3px;
      padding:6px 14px 52px;
      overflow-y:auto;
      align-content:start;
    }
    .reviewRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 8px;
      height:30px;
      border-radius:5px;
      border:1.5px solid;
      cursor:pointer;
      font-size:12px;
      transition:filter .1s;
    }
    .reviewRow:hover{filter:brightness(.94)}
    .reviewRow.row-complete{background:#f0fdf4;border-color:#16a34a}
    .reviewRow.row-incomplete{background:#fef2f2;border-color:#dc2626}
    .reviewRow.row-unseen{background:#f9fafb;border-color:#9ca3af}
    .rrLeft{display:flex;align-items:center;gap:6px;min-width:0}
    .rrNum{font-size:12px;font-weight:700;color:var(--ink);white-space:nowrap}
    .rrCheck{font-size:11px;font-weight:700}
    .row-complete .rrCheck{color:#15803d}
    .row-incomplete .rrCheck{color:#b91c1c}
    .row-unseen .rrCheck{color:#9ca3af}
    .flagIcon{width:22px;height:22px;cursor:pointer}
    .flagIcon .pole{stroke:#1f5d95}
    .flagIcon .outline{stroke:#1f5d95;fill:transparent}
    .flagIcon.on .outline{stroke:#d8342a}
    .flagIcon.on .fill{fill:#d8342a}
    .flagIcon .fill{fill:transparent}
    .reviewFooter{
      position:fixed;left:0;right:0;bottom:0;
      height:44px;
      background:var(--bar);
      border-top:1px solid rgba(255,255,255,.18);
      display:flex;align-items:center;justify-content:space-between;
      padding:0 12px;
      gap:12px;
    }
    .reviewFooter .leftActions{display:flex;align-items:center;gap:10px}
    .reviewFooter .rightActions{display:flex;align-items:center;gap:10px;margin-left:auto}
    .reviewFooter .rbtn{
      height:32px;
      border-radius:0;
      border:1px solid rgba(255,255,255,.55);
      background:transparent;
      color:#fff;
      cursor:pointer;
      font-weight:700;
      padding:0 12px;
      display:flex;align-items:center;gap:8px;
      white-space:nowrap;
    }
    .reviewFooter .rbtn:hover{background:rgba(255,255,255,.10)}
    .reviewFooter .rbtn .mini{width:16px;height:16px;display:inline-block}
    .reviewFooter .secInfo{
      color:rgba(255,255,255,.75);font-size:12px;padding:0 6px;white-space:nowrap;
    }

    /* ── Start / Break shared overlay ── */
    .startOverlay,.breakOverlay{
      position:fixed;inset:0;background:#fff;z-index:10001;
      display:flex;flex-direction:column;
    }
    .breakOverlay{display:none}
    .breakOverlay.open{display:flex}

    .soTopbar,.boTopbar{
      height:44px;background:var(--bar);color:#fff;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 18px;font-size:14px;font-weight:600;flex-shrink:0;
    }
    .soBody,.boBody{
      flex:1;display:flex;align-items:center;justify-content:center;
      background:var(--bg);padding:24px;
    }
    .soCard,.boCard{
      background:var(--card);border-radius:12px;
      box-shadow:0 8px 36px rgba(0,0,0,.13);
      padding:38px 42px;max-width:480px;width:100%;text-align:center;
    }
    .soTitle{font-size:22px;font-weight:800;color:var(--ink);margin-bottom:6px}
    .soMeta{font-size:14px;color:var(--muted);margin-bottom:22px}
    .soList{
      font-size:14px;color:#374151;line-height:1.75;text-align:left;
      background:var(--bg);border-radius:8px;padding:14px 16px;margin-bottom:24px;
    }
    .soList li{list-style:none;margin-bottom:2px}
    .soList li::before{content:"• ";color:var(--bar2)}
    .soStartBtn{
      width:100%;padding:14px;border-radius:8px;border:none;
      background:var(--btn);color:#fff;font-size:16px;font-weight:700;
      cursor:pointer;transition:background .15s;
    }
    .soStartBtn:hover{background:var(--btn2)}

    /* Break overlay specifics */
    .boSubbar{
      height:34px;background:var(--bar2);color:#fff;
      display:flex;align-items:center;padding:0 18px;
      font-weight:700;font-size:14px;flex-shrink:0;
    }
    .boTitle{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);margin-bottom:10px}
    .boClock{
      font-size:72px;font-weight:800;color:var(--ink);
      font-variant-numeric:tabular-nums;line-height:1;margin-bottom:16px;
    }
    .boDesc{font-size:14px;color:var(--muted);line-height:1.65;margin-bottom:28px}
    .boSkipBtn{
      width:100%;padding:12px;border-radius:8px;
      border:1.5px solid var(--line);background:var(--card);
      color:var(--ink);font-size:15px;font-weight:700;cursor:pointer;
      transition:background .15s;
    }
    .boSkipBtn:hover{background:var(--bg)}

    /* ── Section Review ── */
    .secRevOverlay{
      position:fixed;inset:0;background:#fff;z-index:10002;
      display:none;flex-direction:column;
    }
    .secRevOverlay.open{display:flex}
    .secRevWarn{
      background:#fef3c7;border-bottom:2px solid #d97706;
      padding:10px 20px;font-size:13px;font-weight:600;color:#92400e;
      display:flex;align-items:center;gap:8px;flex-shrink:0;
    }
    .secRevBody{
      flex:1;display:flex;flex-direction:column;
      padding:14px 20px 8px;overflow:hidden;min-height:0;
    }
    .secRevHeader{
      display:flex;align-items:baseline;justify-content:space-between;
      margin-bottom:10px;flex-shrink:0;
    }
    .secRevTitle{font-size:16px;font-weight:800;color:var(--ink)}
    .secRevStats{display:flex;gap:18px;font-size:13px;font-weight:600;color:var(--muted)}
    .secRevStats span{display:flex;align-items:center;gap:5px}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block}
    .dot-green{background:#16a34a}
    .dot-red{background:#dc2626}
    .dot-orange{background:#d97706}
    .secRevGrid{
      display:grid;
      grid-template-columns:repeat(10,1fr);
      gap:5px;flex:1;min-height:0;align-content:start;
    }
    .secRevCell{
      border-radius:6px;border:2px solid;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      font-size:11px;font-weight:700;padding:5px 2px;gap:2px;
      position:relative;
    }
    .secRevCell.complete{background:#dcfce7;border-color:#16a34a;color:#15803d}
    .secRevCell.incomplete{background:#fee2e2;border-color:#dc2626;color:#b91c1c}
    .secRevCell .flagDot{
      position:absolute;top:2px;right:3px;
      width:7px;height:7px;border-radius:50%;background:#d97706;
    }
    .secRevCell .cellNum{font-size:12px;font-weight:800}
    .secRevCell .cellStatus{font-size:10px;font-weight:600;opacity:.85}
    .secRevFoot{
      height:50px;background:var(--bar);flex-shrink:0;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 14px;gap:10px;
      border-top:1px solid rgba(255,255,255,.18);
    }

    /* ── Pause overlay ── */
    .pauseOverlay{
      position:fixed;inset:0;background:rgba(0,0,0,.72);
      z-index:10003;display:none;align-items:center;justify-content:center;
    }
    .pauseOverlay.open{display:flex}
    .pauseCard{
      background:#fff;border-radius:12px;padding:40px 48px;text-align:center;
      max-width:380px;width:90%;box-shadow:0 16px 50px rgba(0,0,0,.3);
    }
    .pauseIcon{font-size:40px;margin-bottom:12px}
    .pauseTitle{font-size:22px;font-weight:800;color:var(--ink);margin-bottom:8px}
    .pauseSub{font-size:14px;color:var(--muted);margin-bottom:28px}
    .pauseResumeBtn{
      width:100%;padding:13px;border-radius:8px;border:none;
      background:var(--btn);color:#fff;font-size:15px;font-weight:700;cursor:pointer;
    }
    .pauseResumeBtn:hover{background:var(--btn2)}

    /* Pause chip button in topbar */
    .pauseChip{
      display:inline-flex;align-items:center;gap:6px;
      padding:2px 10px;border-radius:999px;
      background:rgba(255,255,255,.12);
      cursor:pointer;border:none;color:#fff;font-size:13px;font-weight:600;
    }
    .pauseChip:hover{background:rgba(255,255,255,.2)}
    .pauseChip svg{width:14px;height:14px}

    /* ── Continue Later modal ── */
    .clBack{
      position:fixed;inset:0;background:rgba(0,0,0,.5);
      z-index:10004;display:none;align-items:center;justify-content:center;padding:16px;
    }
    .clBack.open{display:flex}
    .clModal{
      width:min(460px,96vw);background:#fff;border-radius:10px;
      box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden;
    }
    .clHead{
      background:var(--bar);color:#fff;
      padding:14px 18px;font-weight:700;font-size:15px;
    }
    .clBody{padding:22px 18px 12px}
    .clBody p{font-size:14px;line-height:1.65;color:var(--ink);margin-bottom:14px}
    .clSaved{
      background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;
      padding:12px 14px;font-size:13px;color:#15803d;margin-bottom:16px;
      display:flex;align-items:center;gap:8px;
    }
    .clLabel{font-size:13px;font-weight:600;color:var(--ink);margin-bottom:6px}
    .clRow{display:flex;gap:8px;margin-bottom:8px}
    .clRow input{
      flex:1;padding:10px 12px;border:1.5px solid var(--line);border-radius:8px;
      font-size:14px;outline:none;
    }
    .clRow input:focus{border-color:var(--btn)}
    .clSendBtn{
      padding:10px 16px;border-radius:8px;border:none;
      background:var(--btn);color:#fff;font-weight:700;cursor:pointer;white-space:nowrap;
      font-size:14px;
    }
    .clSendBtn:hover{background:var(--btn2)}
    .clNote{font-size:12px;color:#9ca3af;margin-bottom:4px;line-height:1.5}
    .clFoot{padding:12px 18px;display:flex;justify-content:flex-end}
    .clCloseBtn{
      padding:9px 18px;border-radius:8px;border:1.5px solid var(--line);
      background:#fff;color:var(--ink);font-weight:600;cursor:pointer;font-size:14px;
    }
    .clCloseBtn:hover{background:var(--bg)}

    /* Continue Later footer button */
    .navbtn--later{
      background:rgba(255,255,255,.08);
      border-color:rgba(255,255,255,.35);
      font-size:13px;
    }

    /* Report Question button */
    .reportBtn{
      display:inline-flex;align-items:center;gap:5px;
      background:none;border:none;
      color:#9ca3af;font-size:12px;
      cursor:pointer;padding:0;
      opacity:.75;transition:opacity .15s,color .15s;
      margin-top:14px;
    }
    .reportBtn:hover{opacity:1;color:#6b7280}
    .reportBtn.reported{color:#d97706;opacity:1}

    /* End Exam button */
    .navbtn--end{
      background:rgba(220,38,38,.18);
      border-color:rgba(220,38,38,.55);
      color:#fca5a5;
    }
    .navbtn--end:hover{background:rgba(220,38,38,.32)}

    /* End Exam confirm modal */
    .confirmBack{
      position:fixed;inset:0;background:rgba(0,0,0,.5);
      display:none;align-items:center;justify-content:center;
      padding:16px;z-index:10000;
    }
    .confirmBack.open{display:flex}
    .confirmModal{
      width:min(440px,94vw);
      background:#fff;border-radius:10px;
      box-shadow:0 20px 60px rgba(0,0,0,.3);
      overflow:hidden;
    }
    .confirmHead{
      background:var(--bar);color:#fff;
      padding:14px 18px;
      font-weight:700;font-size:15px;
    }
    .confirmBody{padding:20px 18px 8px}
    .confirmBody p{font-size:15px;line-height:1.6;color:var(--ink)}
    .confirmBody .warn{
      margin-top:12px;padding:10px 14px;
      background:#fef3c7;border-left:3px solid #d97706;
      border-radius:4px;font-size:13px;color:#92400e;
    }
    .confirmFoot{
      padding:14px 18px;
      display:flex;justify-content:flex-end;gap:10px;
    }
    .confirmFoot button{
      padding:9px 18px;border-radius:8px;
      font-weight:700;cursor:pointer;font-size:14px;border:none;
    }
    .confirmFoot .cancelBtn{background:#f3f4f6;color:var(--ink)}
    .confirmFoot .cancelBtn:hover{background:#e5e7eb}
    .confirmFoot .submitBtn{background:#dc2626;color:#fff}
    .confirmFoot .submitBtn:hover{background:#b91c1c}
  </style>
</head>
<body>

<!-- ══ Start Screen ══ -->
<div class="startOverlay" id="startScreen">
  <div class="soTopbar">
    PMP<span style="font-size:10px;vertical-align:super">®</span>&nbsp;Study Hell<span style="font-size:10px;vertical-align:super">™</span>
  </div>
  <div class="soBody">
    <div class="soCard">
      <div class="soTitle">Practice Exam</div>
      <div class="soMeta">180 Questions &nbsp;•&nbsp; 240 Minutes</div>
      <ul class="soList">
        <li>Two optional 10-minute breaks after questions 60 and 120</li>
        <li>You can end breaks early at any time</li>
        <li>The timer starts when you click <strong>Start Exam</strong></li>
      </ul>
      <button class="soStartBtn" id="startExamBtn">Start Exam</button>
    </div>
  </div>
</div>

<!-- ══ Section Review ══ -->
<div class="secRevOverlay" id="secRevOverlay">
  <div class="boTopbar">
    <span>PMP<span style="font-size:10px;vertical-align:super">®</span>&nbsp;Study Hell<span style="font-size:10px;vertical-align:super">™</span></span>
    <span style="display:flex;align-items:center;gap:8px;font-weight:400">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 7v6l4 2" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z" stroke="white" stroke-width="2"/></svg>
      Time Remaining <strong id="secRevTimer">--:--</strong>
    </span>
  </div>
  <div class="secRevWarn">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 9v4m0 4h.01M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="#92400e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    After proceeding, you <strong>cannot return</strong> to questions in this section.
  </div>
  <div class="secRevBody">
    <div class="secRevHeader">
      <div class="secRevTitle" id="secRevTitle">Section 1 — Questions 1–60</div>
      <div class="secRevStats" id="secRevStats"></div>
    </div>
    <div class="secRevGrid" id="secRevGrid"></div>
  </div>
  <div class="secRevFoot">
    <button class="rbtn" id="secRevBack">&#8592; Go Back</button>
    <button class="rbtn" id="secRevProceed" style="background:rgba(255,255,255,.15);border-color:rgba(255,255,255,.6)">
      Proceed to Break &#8594;
    </button>
  </div>
</div>

<!-- ══ Break Screen ══ -->
<div class="breakOverlay" id="breakOverlay">
  <div class="boTopbar">
    <span>PMP<span style="font-size:10px;vertical-align:super">®</span>&nbsp;Study Hell<span style="font-size:10px;vertical-align:super">™</span></span>
    <span style="display:flex;align-items:center;gap:8px;font-weight:400">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 7v6l4 2" stroke="white" stroke-width="2" stroke-linecap="round"/>
        <path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z" stroke="white" stroke-width="2"/>
      </svg>
      Time Remaining <strong id="mainTimerBreak">--:--</strong>
    </span>
  </div>
  <div class="boSubbar" id="breakLabel">Break 1 of 2</div>
  <div class="boBody">
    <div class="boCard">
      <div class="boTitle">Break Time</div>
      <div class="boClock" id="breakTimer">10:00</div>
      <div class="boDesc">
        You have a 10-minute break. The exam will resume automatically when the timer ends.
        You can also end the break early.
      </div>
      <button class="boSkipBtn" id="endBreakBtn">End Break Early</button>
    </div>
  </div>
</div>

<div class="app">

  <div class="topbar">
    <div class="left" id="examTitle">Demo Exam - Candidate Name</div>
    <div class="right">
      <div class="chip" title="Time Remaining">
        <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 7v6l4 2" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z" stroke="white" stroke-width="2"/>
        </svg>
        <span>Time Remaining</span>
        <span id="timeRemaining" style="font-weight:bold;">240:00</span>
      </div>
      <div class="chip" title="Question Progress">
        <span id="qProgress">1 of 0</span>
      </div>
      <button class="pauseChip" id="pauseBtn" title="Pause exam">
        <svg id="pauseIcon" viewBox="0 0 24 24" fill="white" aria-hidden="true">
          <rect x="6" y="4" width="4" height="16" rx="1"/>
          <rect x="14" y="4" width="4" height="16" rx="1"/>
        </svg>
        <span id="pauseLabel">Pause</span>
      </button>
    </div>
  </div>

  <div class="subbar">
    <a id="openCalc">
      <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M7 2h10a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z" stroke="white" stroke-width="2"/>
        <path d="M8 6h8" stroke="white" stroke-width="2" stroke-linecap="round"/>
        <path d="M8 10h3M13 10h3M8 14h3M13 14h3M8 18h3M13 18h3" stroke="white" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Calculator
    </a>
    <div class="flag" id="flagBtn" role="button" aria-pressed="false" tabindex="0" title="Flag for Review">
      <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path class="flagStroke" d="M6 3v18" stroke-width="2" stroke-linecap="round"/>
        <path class="flagStroke" d="M6 4h12l-2 4 2 4H6z" stroke-width="2" stroke-linejoin="round"/>
        <path class="flagFill" d="M6 4h12l-2 4 2 4H6z"/>
      </svg>
      Flag for Review
    </div>
  </div>

  <div class="main">
    <div class="wrap">
      <div class="hint">
        You are able to select an answer by clicking on the circle to the left of the answer.
        To change your answer, select another answer.
      </div>
      <div class="qtitle">Practice selecting different answers below.</div>
      <div class="question" id="questionText">Which of the below is NOT an animal</div>
      <div class="answers" id="answers"></div>
      <button class="reportBtn" id="reportBtn">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 9v4m0 4h.01M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Report this question
      </button>
    </div>
  </div>

  <div class="footer">
    <div class="footerLeft" style="display:flex;align-items:center;gap:8px;">
      <button class="navbtn navbtn--end" id="endExamBtn">
        End Exam
      </button>
      <button class="navbtn navbtn--later" id="continueLaterBtn">
        Continue Later
      </button>
    </div>
    <div class="footerRight">
      <button class="navbtn navbtn--review" id="openReviewFooter">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="opacity:.85">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="white" stroke-width="2.2" stroke-linecap="round"/>
        </svg>
        Item Review
      </button>
      <div class="navDivider" aria-hidden="true"></div>
      <button class="navbtn" id="prevBtn">
        <span class="arrow left" aria-hidden="true"></span>
        Previous
      </button>
      <button class="navbtn navbtn--next" id="nextBtn">
        Next
        <span class="arrow right" aria-hidden="true"></span>
      </button>
    </div>
  </div>

</div>

<!-- End Exam Confirm -->
<div class="confirmBack" id="confirmBack" aria-hidden="true">
  <div class="confirmModal" role="dialog" aria-modal="true" aria-label="End Exam">
    <div class="confirmHead">End Exam &amp; See Results</div>
    <div class="confirmBody">
      <p>Are you sure you want to end the exam and view your score report?</p>
      <div class="warn" id="confirmWarn"></div>
    </div>
    <div class="confirmFoot">
      <button class="cancelBtn" id="confirmCancel">Continue Exam</button>
      <button class="submitBtn" id="confirmSubmit">End &amp; Submit</button>
    </div>
  </div>
</div>

<!-- Pause Overlay -->
<div class="pauseOverlay" id="pauseOverlay">
  <div class="pauseCard">
    <div class="pauseIcon">⏸</div>
    <div class="pauseTitle">Exam Paused</div>
    <div class="pauseSub">The timer is paused. Click Resume to continue.</div>
    <button class="pauseResumeBtn" id="resumeFromPauseBtn">▶ Resume Exam</button>
  </div>
</div>

<!-- Continue Later Modal -->
<div class="clBack" id="clBack">
  <div class="clModal">
    <div class="clHead">Continue Later</div>
    <div class="clBody">
      <div class="clSaved">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 12l2 2 4-4" stroke="#16a34a" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="10" stroke="#16a34a" stroke-width="2"/></svg>
        Your progress has been saved to this browser.
      </div>
      <p>If you don't have time right now, enter your email and we'll send you a link to continue from where you left off.</p>
      <div class="clLabel">Your email address</div>
      <div class="clRow">
        <input type="email" id="clEmailInput" placeholder="you@example.com">
        <button class="clSendBtn" id="clSendBtn">Send Link</button>
      </div>
      <div class="clNote" id="clNote">We'll send you a link that resumes the exam exactly where you paused.</div>
    </div>
    <div class="clFoot">
      <button class="clCloseBtn" id="clCloseBtn">Close &amp; Resume</button>
    </div>
  </div>
</div>

<!-- Calculator Modal -->
<div class="calcOverlay" id="calcOverlay" aria-hidden="true">
  <div class="calcWin" role="dialog" aria-modal="true" aria-label="Calculator">
    <div class="calcTitle">
      <div class="left">
        <svg class="miniIcon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M7 2h10a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z" stroke="white" stroke-width="2"/>
          <path d="M8 6h8" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span>Calculator</span>
      </div>
      <button id="closeCalc" aria-label="Close calculator">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <div class="calcBody">
      <div class="calcMeta">
        <span>Modes</span>
        <select id="calcMode" aria-label="Calculator mode">
          <option value="standard" selected>Standard</option>
        </select>
      </div>
      <div class="calcDisplay" id="calcDisplay">0</div>
      <div class="calcBrand">
        <small>Texas Instruments</small>
        <span style="font-size:20px;font-weight:900;">TI-108</span>
      </div>
      <div class="calcKeys" id="calcKeys">
        <button class="calcBtn red" data-action="toggleSign">+/−</button>
        <button class="calcBtn red" data-action="sqrt">√</button>
        <button class="calcBtn red" data-action="percent">%</button>
        <button class="calcBtn red" data-action="divide">÷</button>

        <button class="calcBtn red" data-action="mrc">MRC</button>
        <button class="calcBtn red" data-action="mMinus">M−</button>
        <button class="calcBtn red" data-action="mPlus">M+</button>
        <button class="calcBtn red" data-action="multiply">×</button>

        <button class="calcBtn gray" data-num="7">7</button>
        <button class="calcBtn gray" data-num="8">8</button>
        <button class="calcBtn gray" data-num="9">9</button>
        <button class="calcBtn red" data-action="minus">−</button>

        <button class="calcBtn gray" data-num="4">4</button>
        <button class="calcBtn gray" data-num="5">5</button>
        <button class="calcBtn gray" data-num="6">6</button>
        <button class="calcBtn red" data-action="plus">+</button>

        <button class="calcBtn gray" data-num="1">1</button>
        <button class="calcBtn gray" data-num="2">2</button>
        <button class="calcBtn gray" data-num="3">3</button>
        <button class="calcBtn red tall" data-action="equals">=</button>

        <button class="calcBtn red" data-action="clear">ON/C</button>
        <button class="calcBtn gray" data-num="0">0</button>
        <button class="calcBtn gray" data-action="dot">.</button>
      </div>
    </div>
  </div>
</div>

<!-- Item Review -->
<div class="reviewOverlay" id="reviewOverlay" aria-hidden="true">
  <div class="reviewTop">
    <div class="rtLeft" id="reviewTitle">Demo Exam - Candidate Name</div>
    <div class="rtRight">
      <div style="display:flex;align-items:center;gap:8px;">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" aria-hidden="true">
          <path d="M12 8v5l3 2" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z" stroke="white" stroke-width="2"/>
        </svg>
        <span>Time Remaining <span id="reviewTime">--:--</span></span>
      </div>
      <button class="rtBtn" id="closeReview">Back to Exam</button>
    </div>
  </div>

  <div class="reviewSub">
    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" aria-hidden="true">
      <path d="M7 2h10a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z" stroke="white" stroke-width="2"/>
      <path d="M8 6h8" stroke="white" stroke-width="2" stroke-linecap="round"/>
      <path d="M8 10h8M8 14h8M8 18h8" stroke="white" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <a id="reviewInstructions">Instructions</a>
  </div>

  <div class="reviewCenterTitle">Item Review</div>

  <div class="reviewSectionBar">
    <div class="left">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" aria-hidden="true">
        <path d="M4 7h16M4 12h16M4 17h16" stroke="white" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span id="sectionLabel">Items Section</span>
    </div>
    <div class="right" id="sectionSummary">( 0 Unseen/Incomplete )</div>
  </div>

  <div class="reviewList" id="reviewList"></div>

  <div class="reviewFooter">
    <div class="leftActions">
      <button class="rbtn" id="endReviewBtn">
        <span style="font-weight:900">⟫</span>
        End Review
      </button>
      <button class="rbtn" id="prevSectionBtn">&#9664; Prev</button>
      <button class="rbtn" id="nextSectionBtn">Next &#9654;</button>
      <span class="secInfo" id="sectionFooterLeft"></span>
    </div>
    <div class="rightActions">
      <span class="secInfo" id="sectionFooterRight"></span>
      <button class="rbtn" id="reviewAllBtn">
        <svg class="mini" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Review All
      </button>
      <button class="rbtn" id="reviewIncompleteBtn">
        <svg class="mini" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Review Incomplete
      </button>
      <button class="rbtn" id="reviewFlaggedBtn">
        <svg class="mini" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 3v18" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M6 4h12l-2 4 2 4H6z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
        </svg>
        Review Flagged
      </button>
    </div>
  </div>
</div>

<script>

let questions = [];

async function loadExam() {
  try {
    const response = await fetch("./data/pmp_questions.json");
    const data = await response.json();
    questions = data.questions || data;
    render();
  } catch (err) {
    console.error("Exam yüklenemedi:", err);
    alert("Exam data yüklenemedi.");
  }
}

loadExam();

let idx = 0;
let flagged = new Set();
let seen = new Set();
let reported = new Set();
const SECTION_SIZE = 60;
let selected = {};

// --- Render ---
function render(){
  seen.add(idx);
  const q = questions[idx];
  document.getElementById("questionText").textContent = q.text;

  const box = document.getElementById("answers");
  box.innerHTML = "";

  q.answers.forEach((t, i) => {
    const row = document.createElement("label");
    row.className = "ans";

    const radio = document.createElement("input");
    radio.type = "radio";
    radio.name = "ans";
    radio.checked = selected[idx] === i;
    radio.addEventListener("change", () => { selected[idx] = i; });

    const letter = document.createElement("div");
    letter.className = "label";
    letter.textContent = String.fromCharCode(65 + i) + ".";

    const txt = document.createElement("div");
    txt.textContent = t;

    row.appendChild(radio);
    row.appendChild(letter);
    row.appendChild(txt);
    box.appendChild(row);
  });

  // DÜZELTME 1: Gerçek soru numarası
  document.getElementById("qProgress").textContent = `${idx + 1} of ${questions.length}`;

  const flagBtn = document.getElementById("flagBtn");
  const isOn = flagged.has(idx);
  flagBtn.classList.toggle("on", isOn);
  flagBtn.setAttribute("aria-pressed", String(isOn));

  document.getElementById("prevBtn").disabled = idx === 0 || idx <= lockedBefore;

  // Report button state
  const reportBtn = document.getElementById("reportBtn");
  if (reported.has(idx)) {
    reportBtn.className = "reportBtn reported";
    reportBtn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/></svg> Reported ✓`;
  } else {
    reportBtn.className = "reportBtn";
    reportBtn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 9v4m0 4h.01M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Report this question`;
  }

  const nextBtn = document.getElementById("nextBtn");
  const isSecEnd = (idx === 59 && !sectionsCompleted.has(1)) || (idx === 119 && !sectionsCompleted.has(2));
  if (isSecEnd) {
    const secNum = idx === 59 ? 1 : 2;
    nextBtn.innerHTML = `Complete Section ${secNum} <span class="arrow right" aria-hidden="true"></span>`;
    nextBtn.disabled = false;
  } else {
    nextBtn.innerHTML = `Next <span class="arrow right" aria-hidden="true"></span>`;
    nextBtn.disabled = idx === questions.length - 1;
  }
}

// --- Flag ---
const flagBtn = document.getElementById("flagBtn");
function updateFlagBtn(){
  const isOn = flagged.has(idx);
  flagBtn.classList.toggle("on", isOn);
  flagBtn.setAttribute("aria-pressed", String(isOn));
}
function toggleFlag(){
  if(flagged.has(idx)) flagged.delete(idx);
  else flagged.add(idx);
  render();
}
flagBtn.addEventListener("click", toggleFlag);
flagBtn.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggleFlag(); } });

// --- Report Question ---
document.getElementById("reportBtn").addEventListener("click", ()=>{
  if (!reported.has(idx)) {
    reported.add(idx);
    render();
  }
});

// Track which sections have been completed (locked)
const sectionsCompleted = new Set();
let lockedBefore = -1; // questions at idx <= lockedBefore are locked

// --- Nav ---
document.getElementById("prevBtn").addEventListener("click", ()=>{
  if(idx > 0 && idx > lockedBefore){
    idx--;
    render();
  }
});

document.getElementById("nextBtn").addEventListener("click", ()=>{
  const isSecEnd = (idx === 59 && !sectionsCompleted.has(1)) || (idx === 119 && !sectionsCompleted.has(2));
  if (isSecEnd) {
    openSectionReview(idx === 59 ? 1 : 2);
  } else if (idx < questions.length - 1) {
    idx++;
    render();
  }
});

// --- Timer ---
let remaining = 240*60;
let timerInterval = null;
let examPaused = false;
const timeEl = document.getElementById("timeRemaining");
timeEl.textContent = fmtSecs(remaining); // initialize display immediately

function fmtSecs(s){ const mm=Math.floor(s/60),ss=s%60; return String(mm).padStart(2,"0")+":"+String(ss).padStart(2,"0"); }
function startTimer(){ if(timerInterval) return; timerInterval=setInterval(()=>{ remaining=Math.max(0,remaining-1); timeEl.textContent=fmtSecs(remaining); },1000); }
function pauseTimer(){ clearInterval(timerInterval); timerInterval=null; }

setInterval(()=>{
  const t = timeEl.textContent;
  const ro = document.getElementById('reviewOverlay');
  if (ro && ro.classList.contains('open')) document.getElementById('reviewTime').textContent = t;
  const bt = document.getElementById('mainTimerBreak');
  if (bt) bt.textContent = t;
  const st = document.getElementById('secRevTimer');
  if (st) st.textContent = t;
}, 500);

// --- Pause ---
const pauseOverlay = document.getElementById('pauseOverlay');
function setPaused(val) {
  examPaused = val;
  const icon = document.getElementById('pauseIcon');
  const lbl  = document.getElementById('pauseLabel');
  if (val) {
    pauseTimer();
    pauseOverlay.classList.add('open');
    icon.innerHTML = '<polygon points="5,3 19,12 5,21" fill="white"/>';
    lbl.textContent = 'Resume';
  } else {
    pauseOverlay.classList.remove('open');
    icon.innerHTML = '<rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/>';
    lbl.textContent = 'Pause';
    startTimer();
  }
}
document.getElementById('pauseBtn').addEventListener('click', ()=>{ if(!examPaused) setPaused(true); });
document.getElementById('resumeFromPauseBtn').addEventListener('click', ()=> setPaused(false));

// --- Continue Later ---
function saveExamState() {
  const state = {
    idx, selected,
    flagged: [...flagged],
    seen: [...seen],
    reported: [...reported],
    remaining,
    sectionsCompleted: [...sectionsCompleted],
    lockedBefore,
    breaksShown: [...breaksShown]
  };
  localStorage.setItem('examSavedState', JSON.stringify(state));
}

function loadExamState() {
  const raw = localStorage.getItem('examSavedState');
  if (!raw) return false;
  try {
    const s = JSON.parse(raw);
    idx = s.idx ?? 0;
    selected = s.selected ?? {};
    flagged  = new Set(s.flagged ?? []);
    seen     = new Set(s.seen ?? []);
    reported = new Set(s.reported ?? []);
    remaining = s.remaining ?? 240*60;
    (s.sectionsCompleted ?? []).forEach(n => sectionsCompleted.add(n));
    lockedBefore = s.lockedBefore ?? -1;
    (s.breaksShown ?? []).forEach(n => breaksShown.add(n));
    return true;
  } catch(e) { return false; }
}

const clBack = document.getElementById('clBack');
document.getElementById('continueLaterBtn').addEventListener('click', ()=>{
  saveExamState();
  setPaused(true);
  // Close pause overlay, open CL modal instead
  pauseOverlay.classList.remove('open');
  clBack.classList.add('open');
  document.getElementById('clNote').textContent =
    'We\'ll send you a link that resumes the exam exactly where you paused.';
});

document.getElementById('clCloseBtn').addEventListener('click', ()=>{
  clBack.classList.remove('open');
  setPaused(false);
});

document.getElementById('clSendBtn').addEventListener('click', ()=>{
  const email = document.getElementById('clEmailInput').value.trim();
  if (!email || !email.includes('@')) {
    document.getElementById('clNote').textContent = 'Please enter a valid email address.';
    document.getElementById('clNote').style.color = '#dc2626';
    return;
  }
  // UI feedback — actual sending requires backend integration
  document.getElementById('clSendBtn').textContent = 'Sent ✓';
  document.getElementById('clSendBtn').style.background = '#16a34a';
  document.getElementById('clNote').style.color = '#15803d';
  document.getElementById('clNote').textContent =
    `A link has been sent to ${email}. You can close this tab safely — your progress is saved.`;
});

// --- Start Screen ---
const breaksShown = new Set();

// Check for saved state and show resume option
(function initStartScreen() {
  const raw = localStorage.getItem('examSavedState');
  if (raw) {
    try {
      const s = JSON.parse(raw);
      const pct = Math.round((Object.keys(s.selected || {}).length / 180) * 100);
      const timeLeft = fmtSecs(s.remaining ?? 14400);
      const resumeDiv = document.createElement('div');
      resumeDiv.style.cssText = 'margin-bottom:12px;';
      resumeDiv.innerHTML = `
        <div style="background:#eff6ff;border:1.5px solid #bfdbfe;border-radius:8px;padding:12px 14px;margin-bottom:12px;text-align:left;font-size:13px;">
          <div style="font-weight:700;color:#1d4ed8;margin-bottom:4px;">Saved progress found</div>
          <div style="color:#374151">${pct}% answered &nbsp;•&nbsp; ${timeLeft} remaining</div>
        </div>
        <button id="resumeExamBtn" style="width:100%;padding:11px;border-radius:8px;border:1.5px solid #2f6ea5;background:#fff;color:#2f6ea5;font-size:15px;font-weight:700;cursor:pointer;margin-bottom:8px;">Resume Saved Exam</button>
      `;
      const card = document.querySelector('.soCard');
      card.insertBefore(resumeDiv, card.querySelector('.soStartBtn'));
      document.getElementById('resumeExamBtn').addEventListener('click', ()=>{
        if (loadExamState()) {
          document.getElementById('startScreen').style.display = 'none';
          timeEl.textContent = fmtSecs(remaining);
          render();
          startTimer();
          localStorage.removeItem('examSavedState');
        }
      });
    } catch(e) {}
  }
})();

document.getElementById('startExamBtn').addEventListener('click', ()=>{
  localStorage.removeItem('examSavedState');
  document.getElementById('startScreen').style.display = 'none';
  startTimer();
});

// --- Break ---
let breakInterval = null;
let breakRemaining = 600;
const breakOverlay  = document.getElementById('breakOverlay');
const breakTimerEl  = document.getElementById('breakTimer');
const breakLabelEl  = document.getElementById('breakLabel');

function updateBreakClock(){ breakTimerEl.textContent = fmtSecs(breakRemaining); }

function endBreak(){
  clearInterval(breakInterval); breakInterval = null;
  breakOverlay.classList.remove('open');
  startTimer();
}

function showBreak(num){
  if(breaksShown.has(num)) return;
  breaksShown.add(num);
  pauseTimer();
  breakRemaining = 600;
  updateBreakClock();
  breakLabelEl.textContent = `Break ${num} of 2`;
  breakOverlay.classList.add('open');
  breakInterval = setInterval(()=>{
    breakRemaining = Math.max(0, breakRemaining - 1);
    updateBreakClock();
    if(breakRemaining <= 0) endBreak();
  }, 1000);
}

document.getElementById('endBreakBtn').addEventListener('click', endBreak);

// ===== Section Review =====
const secRevOverlay = document.getElementById('secRevOverlay');
let pendingSectionNum = 0;

function openSectionReview(secNum) {
  pendingSectionNum = secNum;
  pauseTimer();

  const start = (secNum - 1) * SECTION_SIZE;
  const end   = Math.min(questions.length, secNum * SECTION_SIZE);

  document.getElementById('secRevTitle').textContent =
    `Section ${secNum} — Questions ${start + 1}–${end}`;

  // Stats
  let answered = 0, unanswered = 0, flaggedCount = 0;
  for (let i = start; i < end; i++) {
    if (selected[i] !== undefined) answered++; else unanswered++;
    if (flagged.has(i)) flaggedCount++;
  }
  const statsEl = document.getElementById('secRevStats');
  statsEl.innerHTML =
    `<span><span class="dot dot-green"></span>${answered} Answered</span>` +
    `<span><span class="dot dot-red"></span>${unanswered} Unanswered</span>` +
    (flaggedCount ? `<span><span class="dot dot-orange"></span>${flaggedCount} Flagged</span>` : '');

  // Grid
  const grid = document.getElementById('secRevGrid');
  grid.innerHTML = '';
  for (let i = start; i < end; i++) {
    const cell = document.createElement('div');
    const done = selected[i] !== undefined;
    cell.className = 'secRevCell ' + (done ? 'complete' : 'incomplete');
    cell.innerHTML =
      `<span class="cellNum">${i + 1}</span>` +
      `<span class="cellStatus">${done ? '✓' : '—'}</span>` +
      (flagged.has(i) ? '<span class="flagDot"></span>' : '');
    grid.appendChild(cell);
  }

  secRevOverlay.classList.add('open');
}

document.getElementById('secRevBack').addEventListener('click', ()=>{
  secRevOverlay.classList.remove('open');
  startTimer();
});

document.getElementById('secRevProceed').addEventListener('click', ()=>{
  secRevOverlay.classList.remove('open');
  sectionsCompleted.add(pendingSectionNum);
  lockedBefore = pendingSectionNum * SECTION_SIZE - 1;
  idx = pendingSectionNum * SECTION_SIZE;
  render();
  showBreak(pendingSectionNum);
});


// ===== Calculator (TI-108) =====
const calcOverlay = document.getElementById('calcOverlay');
const calcDisplay = document.getElementById('calcDisplay');
const calcKeys    = document.getElementById('calcKeys');

let calcMem = 0, calcValue = "0", calcPending = null, calcStored = null, calcFresh = true;

function calcRender(){ calcDisplay.textContent = calcValue; }
function calcSet(v){ calcValue = v === "" ? "0" : v; calcRender(); }
function calcNum(){ return Number(calcValue); }
function calcFormat(n){
  if (!Number.isFinite(n)) return "Error";
  let s = String(n);
  if (s.includes("e")) return s;
  if (s.includes(".")) s = s.replace(/0+$/,"").replace(/\.$/,"");
  return s === "" ? "0" : s;
}
function calcApplyOp(op, a, b){
  if (op==="+") return a+b;
  if (op==="-") return a-b;
  if (op==="*") return a*b;
  if (op==="/") return b===0 ? NaN : a/b;
  return b;
}
function calcPressDigit(d){
  if (calcValue==="Error") calcValue="0";
  if (calcFresh){ calcValue=d; calcFresh=false; }
  else { calcValue = calcValue==="0" ? d : calcValue+d; }
  calcRender();
}
function calcPressDot(){
  if (calcValue==="Error") calcValue="0";
  if (calcFresh){ calcValue="0."; calcFresh=false; }
  else if (!calcValue.includes(".")) calcValue+=".";
  calcRender();
}
function calcClear(){ calcValue="0"; calcPending=null; calcStored=null; calcFresh=true; calcRender(); }
function calcSetOp(op){
  if (calcValue==="Error") return;
  const cur=calcNum();
  if (calcStored===null) calcStored=cur;
  else if (!calcFresh && calcPending){ calcStored=calcApplyOp(calcPending,calcStored,cur); calcSet(calcFormat(calcStored)); }
  calcPending=op; calcFresh=true;
}
function calcEquals(){
  if (calcValue==="Error"||calcPending===null||calcStored===null) return;
  const res=calcApplyOp(calcPending,calcStored,calcNum());
  calcStored=res; calcPending=null; calcSet(calcFormat(res)); calcFresh=true;
}
function calcToggleSign(){
  if (calcValue==="Error"||calcValue==="0") return;
  calcValue=calcValue.startsWith("-") ? calcValue.slice(1) : "-"+calcValue; calcRender();
}
function calcSqrt(){ if(calcValue==="Error")return; calcSet(calcFormat(Math.sqrt(calcNum()))); calcFresh=true; }
function calcPercent(){ if(calcValue==="Error")return; calcSet(calcFormat(calcNum()/100)); calcFresh=true; }

document.getElementById('openCalc').addEventListener('click', (e)=>{ e.preventDefault(); calcOverlay.classList.add('open'); calcOverlay.setAttribute('aria-hidden','false'); });
document.getElementById('closeCalc').addEventListener('click', ()=>{ calcOverlay.classList.remove('open'); calcOverlay.setAttribute('aria-hidden','true'); });
calcOverlay.addEventListener('click', (e)=>{ if(e.target===calcOverlay){ calcOverlay.classList.remove('open'); calcOverlay.setAttribute('aria-hidden','true'); } });
document.addEventListener('keydown', (e)=>{ if(calcOverlay.classList.contains('open')&&e.key==="Escape"){ calcOverlay.classList.remove('open'); calcOverlay.setAttribute('aria-hidden','true'); } });

calcKeys.addEventListener('click', (e)=>{
  const btn=e.target.closest('button');
  if(!btn) return;
  const num=btn.getAttribute('data-num');
  const action=btn.getAttribute('data-action');
  if(num!==null){ calcPressDigit(num); return; }
  switch(action){
    case "dot":        calcPressDot(); break;
    case "clear":      calcClear(); break;
    case "plus":       calcSetOp("+"); break;
    case "minus":      calcSetOp("-"); break;
    case "multiply":   calcSetOp("*"); break;
    case "divide":     calcSetOp("/"); break;
    case "equals":     calcEquals(); break;
    case "toggleSign": calcToggleSign(); break;
    case "sqrt":       calcSqrt(); break;
    case "percent":    calcPercent(); break;
    case "mrc":
      if(btn.dataset.mrcState==="recalled"){ calcMem=0; btn.dataset.mrcState=""; }
      else { calcSet(calcFormat(calcMem)); btn.dataset.mrcState="recalled"; calcFresh=true; }
      break;
    case "mPlus":  calcMem+=(calcValue==="Error"?0:calcNum()); document.querySelector('[data-action="mrc"]').dataset.mrcState=""; break;
    case "mMinus": calcMem-=(calcValue==="Error"?0:calcNum()); document.querySelector('[data-action="mrc"]').dataset.mrcState=""; break;
  }
});


// ===== Item Review =====
const reviewOverlay      = document.getElementById('reviewOverlay');
const reviewList         = document.getElementById('reviewList');
const sectionLabel       = document.getElementById('sectionLabel');
const sectionSummary     = document.getElementById('sectionSummary');
const sectionFooterLeft  = document.getElementById('sectionFooterLeft');
const sectionFooterRight = document.getElementById('sectionFooterRight');
const prevSectionBtn     = document.getElementById('prevSectionBtn');
const nextSectionBtn     = document.getElementById('nextSectionBtn');
const reviewTime         = document.getElementById('reviewTime');

let reviewFilter = "all";
let currentSection = 0;

function secCount(){ return Math.max(1, Math.ceil(questions.length / SECTION_SIZE)); }
function secBounds(s){ return { start: s*SECTION_SIZE, end: Math.min(questions.length, s*SECTION_SIZE+SECTION_SIZE) }; }
function qStatus(i){
  if (!seen.has(i)) return "unseen";
  return selected[i]!==undefined ? "complete" : "incomplete";
}

function renderReview(){
  const totalSec = secCount();
  currentSection = Math.min(Math.max(0, currentSection), totalSec-1);
  const b = secBounds(currentSection);

  let unseen=0, incomplete=0, answered=0, flaggedCount=0;
  for (let i=b.start; i<b.end; i++){
    const st=qStatus(i);
    if (reviewFilter==="flagged"   && !flagged.has(i))   continue;
    if (reviewFilter==="incomplete" && st==="complete")  continue;
    if (st==="unseen") unseen++;
    else if (st==="incomplete") incomplete++;
    else answered++;
    if (flagged.has(i)) flaggedCount++;
  }
  sectionSummary.textContent     = `( ${unseen+incomplete} Unseen/Incomplete )`;
  sectionFooterLeft.textContent  = `Section ${currentSection+1} of ${totalSec}`;
  sectionFooterRight.textContent = `Answered: ${answered} • Incomplete: ${unseen+incomplete} • Flagged: ${flaggedCount}`;

  // DÜZELTME 2: Listeye de filtre uygulanıyor
  reviewList.innerHTML = "";
  for (let i=b.start; i<b.end; i++){
    const st=qStatus(i);
    if (reviewFilter==="flagged"    && !flagged.has(i))  continue;
    if (reviewFilter==="incomplete" && st==="complete")  continue;

    const row = document.createElement("div");
    const stClass = st==="complete" ? "row-complete" : st==="incomplete" ? "row-incomplete" : "row-unseen";
    row.className = `reviewRow ${stClass}`;

    // Left side: Q number + status check
    const rrLeft = document.createElement("span");
    rrLeft.className = "rrLeft";
    const rrNum = document.createElement("span");
    rrNum.className = "rrNum";
    rrNum.textContent = `Q.${i+1}`;
    const rrCheck = document.createElement("span");
    rrCheck.className = "rrCheck";
    rrCheck.textContent = st==="complete" ? "✓" : st==="incomplete" ? "—" : "?";
    rrLeft.appendChild(rrNum);
    rrLeft.appendChild(rrCheck);

    // Flag icon (right)
    const flagSvg = document.createElementNS("http://www.w3.org/2000/svg","svg");
    flagSvg.setAttribute("viewBox","0 0 24 24");
    flagSvg.classList.add("flagIcon");
    flagSvg.style.cssText = "width:14px;height:14px;flex-shrink:0";
    if (flagged.has(i)) flagSvg.classList.add("on");
    flagSvg.innerHTML = `
      <path class="pole" d="M6 3v18" stroke-width="2" stroke-linecap="round" fill="none"/>
      <path class="outline" d="M6 4h12l-2 4 2 4H6z" stroke-width="2" stroke-linejoin="round"/>
      <path class="fill" d="M6 4h12l-2 4 2 4H6z"/>
    `;
    flagSvg.addEventListener("click", (e)=>{
      e.stopPropagation();
      flagged.has(i) ? flagged.delete(i) : flagged.add(i);
      updateFlagBtn();
      renderReview();
    });

    row.appendChild(rrLeft);
    row.appendChild(flagSvg);
    row.addEventListener("click", (e)=>{
      if (!e.target.closest(".flagIcon")) { idx=i; render(); closeReview(); }
    });
    reviewList.appendChild(row);
  }

  reviewTime.textContent = timeEl.textContent || "--:--";
  prevSectionBtn.disabled = currentSection===0;
  nextSectionBtn.disabled = currentSection===totalSec-1;
}

function openReview(){
  reviewFilter="all";
  reviewOverlay.classList.add("open");
  reviewOverlay.setAttribute("aria-hidden","false");
  currentSection=Math.floor(idx/SECTION_SIZE);
  renderReview();
}
function closeReview(){
  reviewOverlay.classList.remove("open");
  reviewOverlay.setAttribute("aria-hidden","true");
}

document.getElementById('openReviewFooter').addEventListener("click", (e)=>{ e.preventDefault(); openReview(); });
document.getElementById('closeReview').addEventListener("click", closeReview);
prevSectionBtn.addEventListener("click", ()=>{ currentSection--; renderReview(); });
nextSectionBtn.addEventListener("click", ()=>{ currentSection++; renderReview(); });
document.getElementById('endReviewBtn').addEventListener("click", closeReview);
document.getElementById('reviewAllBtn').addEventListener("click", ()=>{ reviewFilter="all"; renderReview(); });
document.getElementById('reviewIncompleteBtn').addEventListener("click", ()=>{ reviewFilter="incomplete"; renderReview(); });
document.getElementById('reviewFlaggedBtn').addEventListener("click", ()=>{ reviewFilter="flagged"; renderReview(); });

updateFlagBtn();

// ===== End Exam =====
const confirmBack   = document.getElementById('confirmBack');
const confirmWarn   = document.getElementById('confirmWarn');
const confirmCancel = document.getElementById('confirmCancel');
const confirmSubmit = document.getElementById('confirmSubmit');

document.getElementById('endExamBtn').addEventListener('click', () => {
  const answered   = Object.keys(selected).length;
  const unanswered = questions.length - answered;
  confirmWarn.textContent = unanswered > 0
    ? `⚠ You have ${unanswered} unanswered question${unanswered !== 1 ? 's' : ''}. Unanswered questions will be marked as incorrect.`
    : '✓ All questions have been answered.';
  confirmBack.classList.add('open');
  confirmBack.setAttribute('aria-hidden', 'false');
});

confirmCancel.addEventListener('click', () => {
  confirmBack.classList.remove('open');
  confirmBack.setAttribute('aria-hidden', 'true');
});
confirmBack.addEventListener('click', (e) => {
  if (e.target === confirmBack) {
    confirmBack.classList.remove('open');
    confirmBack.setAttribute('aria-hidden', 'true');
  }
});

confirmSubmit.addEventListener('click', () => {
  const total      = questions.length;
  const answered   = Object.keys(selected).length;
  const unanswered = total - answered;
  const timeUsed   = 240 * 60 - remaining; // seconds elapsed

  // Score: requires correct answers in question data (q.correct = 0-3 index).
  // Falls back to answered% if no correct answers are present.
  let correct = 0;
  if (questions[0] && questions[0].correct !== undefined) {
    for (let i = 0; i < total; i++) {
      if (selected[i] !== undefined && selected[i] === questions[i].correct) correct++;
    }
  } else {
    // Placeholder: treat answered as correct (update when answers are added)
    correct = answered;
  }

  const incorrect = answered - correct;
  const score     = Math.round((correct / total) * 100);

  // Domain split (equal thirds by default; override when domain field is added to questions)
  const domainSize = Math.ceil(total / 3);
  function domainScore(start, end) {
    let c = 0, t = 0;
    for (let i = start; i < Math.min(end, total); i++) {
      t++;
      if (selected[i] !== undefined) {
        if (questions[0].correct !== undefined) {
          if (selected[i] === questions[i].correct) c++;
        } else {
          c++;
        }
      }
    }
    return t > 0 ? Math.round((c / t) * 100) : 0;
  }

  const result = {
    score,
    correct,
    incorrect,
    unanswered,
    total,
    timeUsed,
    timeTotal: 240 * 60,
    date: new Date().toISOString(),
    domains: {
      people:   { score: domainScore(0, 60),   label: "People",               weight: "42%" },
      process:  { score: domainScore(60, 150),  label: "Process",              weight: "50%" },
      business: { score: domainScore(150, 180), label: "Business Environment", weight: "8%"  }
    }
  };

  try { localStorage.setItem('pmpResult', JSON.stringify(result)); } catch(e) {}
  location.href = 'result.html';
});

</script>
</body>
</html>
